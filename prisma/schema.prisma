// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Модель группы растений
model PlantGroup {
  id     Int     @id @default(autoincrement())
  name   String // Название группы растений
  plants Plant[] // Связь "один ко многим" с растениями

  @@map("plant_group")
}

// Модель растения\
model Plant {
  id           Int        @id @default(autoincrement())
  name         String
  description  String
  plantGroupId Int        @map("plant_group_id")
  plantGroup   PlantGroup @relation(fields: [plantGroupId], references: [id]) // Связь с группой растений
  norms        Norms?     @relation("PlantNorms") // Опциональная связь с Norms
  zones        Zone[] // Связь "один ко многим" с зонами

  @@map("plant")
}

// Модель норм параметров для растения (зона + станция)
model Norms {
  id                    Int   @id @default(autoincrement())
  temperature           Float
  airHumidity           Float @map("air_humidity")
  substrateHumidity     Float @map("substrate_humidity")
  phLevel               Float @map("ph_level")
  nutrientConcentration Float @map("nutrient_concentration") // Концентрация питательных веществ (EC)
  solutionTemperature   Float @map("solution_temperature") // Температура раствора (°C)
  solutionLvl           Float @map("solution_lvl")
  lightIntensity        Float @map("light_intensity")
  plantId               Int   @unique @map("plant_id") // Уникальная связь с растением
  plant                 Plant @relation("PlantNorms", fields: [plantId], references: [id]) // Связь с растением

  @@map("norms")
}

model Zone {
  id        Int     @id @default(autoincrement())
  name      String // Название зоны
  plantId   Int     @map("plant_id") // Внешний ключ на растение
  plant     Plant   @relation(fields: [plantId], references: [id]) // Связь с растением
  isLightOn Boolean @default(false) @map("is_light_on") // Включён ли свет

  zoneParamsId Int        @unique @map("zone_params_id")
  zoneParams   ZoneParams @relation(fields: [zoneParamsId], references: [id]) // Связь с параметрами зоны

  stationParamsId Int           @unique @map("station_params_id")
  stationParams   StationParams @relation(fields: [stationParamsId], references: [id]) // Связь с параметрами станции

  @@map("zone")
}

// Параметры зоны выращивания
model ZoneParams {
  id                Int   @id @default(autoincrement())
  temperature       Float // Температура (°C)
  airHumidity       Float @map("air_humidity") // Влажность воздуха (%)
  substrateHumidity Float @map("substrate_humidity") // Влажность субстрата (%)
  zone              Zone? @relation() // Убраны fields и references

  @@map("zone_params")
}

// Параметры станции (гидропоники)
model StationParams {
  id                    Int   @id @default(autoincrement())
  phLevel               Float @map("ph_level") // Уровень pH
  nutrientConcentration Float @map("nutrient_concentration") // Концентрация питательных веществ (EC)
  solutionTemperature   Float @map("solution_temperature") // Температура раствора (°C)
  solutionLvl           Float @map("solution_lvl") // Уровень раствора (%)
  station               Zone? @relation() // Убраны fields и references

  @@map("station_params")
}
